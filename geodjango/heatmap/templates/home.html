<script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=getMap' async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>
    var heatMap = null;
    var map = null;
    var locations = [];

    function getMap(){
        var loc = new Microsoft.Maps.Location(47.6117309, -122.3351027);
        var mapOptions = {
            zoom: 10,
            center: loc,
            credentials: 'AmTOjxQXZeKHxacoFI3IoPyR6PHW0U-r0NgDSQ8F-x0dt97mnLMFKREiS96mkOkX',
        };
        map = new Microsoft.Maps.Map($('.map')[0], mapOptions);

        Microsoft.Maps.loadModule('Microsoft.Maps.HeatMap', function () {
            console.log('Test')
            timeout();
        });

    }

    function timeout(){
        setTimeout(
            function() 
            {
                $.post("{% url 'heatmap-home' %}",
                function (data) {
                    locations.push(data.lat, data.long);
                    heatMap = new Microsoft.Maps.HeatMapLayer(locations);
                    map.layers.insert(heatMap);
                }, 'json');
                timeout();
            }, 500);
    }
</script>
<body onload="getMap()">
    <div class="map" style="width: 100%; height: 100%;"></div>
</body>